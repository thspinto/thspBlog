<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.66.0" />

    
    
    

<title>My Raspberry Pi Setup • My Tech Notes</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="My Raspberry Pi Setup"/>
<meta name="twitter:description" content="Tired of configuring my RBP I&rsquo;ve had a raspberry pi for a while and most of the time it rests off in a drawer. From time to time I dust off the SD card to setup the box with dynamic DNS and play with it as my personal server."/>

<meta property="og:title" content="My Raspberry Pi Setup" />
<meta property="og:description" content="Tired of configuring my RBP I&rsquo;ve had a raspberry pi for a while and most of the time it rests off in a drawer. From time to time I dust off the SD card to setup the box with dynamic DNS and play with it as my personal server." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://thsp.dev/posts/my-rbp-setup/" />
<meta property="article:published_time" content="2020-03-08T20:29:49-03:00" />
<meta property="article:modified_time" content="2020-03-29T12:09:00-03:00" /><meta property="og:site_name" content="Thiago&#39;s Tech Notes" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.8cda9ac8bf07de91f988b33c020d5742509c4b4ffa3f06795dacc791c7ee6f46.css" integrity="sha256-jNqayL8H3pH5iLM8Ag1XQlCcS0/6PwZ5XazHkcfub0Y=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.ico">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://thsp.dev/">My Tech Notes</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://thsp.dev/avatar.png" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         Don&#39;t forget your towel 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">My Tech Notes</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/thspinto" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/thspinto" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/thspinto" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 - 2020 htr3n
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>My Raspberry Pi Setup</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> 2020-03-08
    
    
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/ansible">ansible</a>
           
      
          <a class="badge badge-tag" href="/tags/rbp">rbp</a>
           
      
          <a class="badge badge-tag" href="/tags/raspberry">raspberry</a>
           
      
          <a class="badge badge-tag" href="/tags/auth0">auth0</a>
           
      
          <a class="badge badge-tag" href="/tags/traefik">traefik</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 3 min read
</div>


  </header>
  
  
  <div class="post">
    <p><img src="/rbp.jpg" alt="Raspberry Pi Logo in front of blue circuit board"></p>
<h1 id="tired-of-configuring-my-rbp">Tired of configuring my RBP</h1>
<p>I&rsquo;ve had a raspberry pi for a while and most of the time it rests off in a drawer. From time to time I dust off the SD card to setup the box with dynamic DNS and play with it as my personal server. It always went back to the drawer when my vacation fished and I broke the SO with some crazy experiment.</p>
<p>As an SRE I spend most of my time thinking what flows are more burdensome to the team and how can we automate the process to gain more time to do cool more cool stuff. But with the RBP it was different, I&rsquo;d never versioned the scripts I executed and never though about creating a proper automation for the box.</p>
<p>This time I started differently to avoid giving up on the Pi again. Every configuration running on the Pi must be replayable so I can fix it just by burning a new SO in the SD card and running the automation to set it up. What I have up to now is <a href="https://github.com/thspinto/raspberry-config">here</a>.</p>
<h1 id="how-i-did-it">How I did it</h1>
<h2 id="provisioning-raspbian">Provisioning Raspbian</h2>
<p>Start off with the <a href="https://www.raspberrypi.org/downloads/raspbian">Rasbian Buster Lite image</a> and burn it on the SD card. Just assure you&rsquo;re pointing to the right disk before running the commands below.</p>
<pre><code>unzip -p 2020-02-13-raspbian-buster-lite.zip | sudo dd of=/dev/disk2 bs=4m
touch /Volumes/boot/ssh # to enable ssh
</code></pre><h2 id="ansible-automation">Ansible automation</h2>
<p>Ansible <a href="https://docs.ansible.com/ansible/latest/index.html">Ansible</a> is a great tool for automating systems configurations. This setup starts with the default user and password.</p>
<h3 id="initialize">Initialize</h3>
<p>The <code>initialize</code> playbook adds my user and public keys to the RBP and disables password ssh logins.</p>
<pre><code>ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook initialize.yaml -i inventories/thspinto
</code></pre><p>Notice that <code>inventories/thspinto/all.yaml</code> is unreadable. That&rsquo;s because its encrypted with <a href="https://docs.ansible.com/ansible/latest/user_guide/vault.html#file-level-encryption">Ansible Vault</a>. I don&rsquo;t recommend versioning secrets in public repositories for most use cases, even if they are encrypted. In my case I versioned it because I&rsquo;ll certainly lose the file otherwise. Also, in my case, the only sensitive information in is a token to alter my personal DNS registry. Since there is virtually no traffic in my domain, it&rsquo;s no big deal.</p>
<h3 id="basic-setup">Basic setup</h3>
<p>The second phase it doing a little hardening and adding docker. This is done on the setup playbook.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible-galaxy install -r requirements.yml
ansible-playbook --vault-password-file /path/to/my/vault-password-file setup.yaml -i inventories/thspinto
</code></pre></div><h3 id="services">Services</h3>
<p>The last playbook spins up the services I want to run using docker compose. I separated it from the rest because it is the most frequently changed and deployed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible-playbook --vault-password-file /path/to/my/vault-password-file services.yaml -i inventories/thspinto
</code></pre></div><p>Currently I run:</p>
<ul>
<li><a href="https://github.com/oznu/docker-cloudflare-ddns">Cloudflare DDNS</a> to register the Pi&rsquo;s id the my domain.</li>
<li><a href="https://docs.traefik.io">Traefik 2.1</a> as proxy with docker service discovery</li>
<li><a href="https://github.com/thomseddon/traefik-forward-auth">ForwardAuth</a> to have OpenConnectID login using <a href="https://auth0.com/">Auth0</a></li>
</ul>
<h1 id="my-pi">My Pi</h1>
<p>Everything runs fine on model B with one 700MHz core and 512MB of ram. Checkout the <a href="https://github.com/thspinto/raspberry-config">raspberry-config repo</a> for more details and updates. Can&rsquo;t do much with this hardware, that&rsquo;s why as next steps I&rsquo;m considering buying more RBPs and setting up a clustered environment with <a href="https://k3s.io/">k3s</a>.</p>

  </div>
  

<div class="navigation navigation-single">
    
    
</div>


  




  
    
        <div id="disqus_thread"></div>
<script type="text/javascript">
    

    (function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'thsp-dev';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
  <span class="logo-disqus">Disqus</span>
</a>

    


</article>


        </div>
        
    

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-160020317-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
